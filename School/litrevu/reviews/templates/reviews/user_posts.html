{% extends 'reviews/base.html' %}

{% block title %}Mes posts - LITReview{% endblock %}

{% block content %}
<h2 style="margin-bottom: 30px;">Vos posts</h2>

{% if posts %}
    {% for post in posts %}
        <div class="card">
            {% if post.post_type == 'ticket' %}
                <!-- Afficher un ticket -->
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <div>
                        <p style="font-size: 14px; color: #666; margin-bottom: 5px;">Vous avez demandé une critique</p>
                        <p style="font-size: 12px; color: #999;">{{ post.time_created|date:"H:i, d M Y" }}</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <a href="{% url 'edit_ticket' post.id %}" class="btn btn-secondary" style="font-size: 12px; padding: 5px 10px;">Modifier</a>
                        <a href="{% url 'delete_ticket' post.id %}" class="btn btn-danger" style="font-size: 12px; padding: 5px 10px;">Supprimer</a>
                    </div>
                </div>
                <h3 style="margin-bottom: 10px; font-size: 18px;">{{ post.title }}</h3>
                <p style="color: #666; margin-bottom: 15px;">{{ post.description }}</p>
                {% if post.image %}
                <img src="{{ post.image.url }}" alt="{{ post.title }}" style="max-width: 200px; border-radius: 4px;">
                {% endif %}
            {% else %}
                <!-- Afficher une critique -->
                <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                    <div>
                        <p style="font-size: 14px; color: #666; margin-bottom: 5px;">Vous avez publié une critique</p>
                        <p style="font-size: 12px; color: #999;">{{ post.time_created|date:"H:i, d M Y" }}</p>
                    </div>
                    <div style="display: flex; gap: 10px;">
                        <a href="{% url 'edit_review' post.id %}" class="btn btn-secondary" style="font-size: 12px; padding: 5px 10px;">Modifier</a>
                        <a href="{% url 'delete_review' post.id %}" class="btn btn-danger" style="font-size: 12px; padding: 5px 10px;">Supprimer</a>
                    </div>
                </div>
                <h3 style="margin-bottom: 10px; font-size: 18px;">{{ post.headline }} - {{ post.rating }}★</h3>
                <p style="color: #666; margin-bottom: 15px;">{{ post.body }}</p>
                
                <!-- Afficher le ticket associé -->
                <div style="background-color: #f9f9f9; border: 1px solid #e0e0e0; border-radius: 4px; padding: 15px; margin-top: 15px;">
                    <p style="font-size: 13px; color: #666; margin-bottom: 10px;">Ticket - {{ post.ticket.user.username }}</p>
                    <h4 style="margin-bottom: 5px; font-size: 16px;">{{ post.ticket.title }}</h4>
                    {% if post.ticket.image %}
                    <img src="{{ post.ticket.image.url }}" alt="{{ post.ticket.title }}" style="max-width: 150px; border-radius: 4px; margin-top: 10px;">
                    {% endif %}
                </div>
            {% endif %}
        </div>
    {% endfor %}
{% else %}
    <div class="card" style="text-align: center; padding: 40px;">
        <p style="color: #666;">Vous n'avez pas encore créé de posts.</p>
        <a href="{% url 'create_ticket' %}" class="btn btn-primary" style="margin-top: 20px;">Créer un ticket</a>
    </div>
{% endif %}
{% endblock %}